yHistoryExtraction] â„¹ï¸ No family history changes made - may be no family history content or all information already documented
ğŸ”¥ [FAMILY HISTORY WORKFLOW] ============= FAMILY HISTORY EXTRACTION COMPLETE =============
ğŸš¬ [UnifiedSocialHistory] Error fetching existing social history: error: column "source_notes" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async UnifiedSocialHistoryParser.getExistingSocialHistory (/home/runner/workspace/server/unified-social-history-parser.ts:184:24)
    at async UnifiedSocialHistoryParser.processUnified (/home/runner/workspace/server/unified-social-history-parser.ts:118:9)
    at async AttachmentChartProcessor.processDocumentForSocialHistory (/home/runner/workspace/server/attachment-chart-processor.ts:970:22)
    at async Promise.allSettled (index 4)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9) {
  length: 113,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '137',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
ğŸš¬ [UnifiedSocialHistory] Found 0 existing social history entries for patient 11
[Chart Service] Fetching chart data for patient 11
ğŸ“„ [UnifiedImagingParser] Patient ID: 11
[Chart Service] Fetching chart data for patient 11
ğŸ’Š [AttachmentMedications] Found 9 existing medications for consolidation
ğŸ©º [VitalsExtraction] ğŸ” Calling parseVitalsText with: {
  textLength: 534,
  textPreview: 'Laboratory & Imaging Results (Initial Workup Pending Further Testing)\n' +
    'Labwork 6/12/10\n' +
    '  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)\n' +
    '  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight w',
  patientContext: { age: 69, gender: 'male' },
  patientId: 11
}
ğŸ”¥ [VITALS PARSING] ============= STARTING GPT-4.1-NANO VITALS PARSING =============
ğŸ©º [VitalsParser] Input text length: 534 characters
ğŸ©º [VitalsParser] Patient context: { age: 69, gender: 'male' }
ğŸ©º [VitalsParser] Parsing vitals text preview: Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight w...
ğŸ©º [VitalsParser] Starting AI parsing process...
ğŸš¨ [UnifiedAllergy] Found 2 existing allergy entries for patient 11
[Chart Service] Fetching chart data for patient 11
âš—ï¸ [LabParser] Found 0 existing lab results for consolidation analysis
âš—ï¸ [LabParser] ğŸ¤– Calling OpenAI GPT-4.1...
âš—ï¸ [LabParser] ğŸ¤– Model: gpt-4.1, Temperature: 0.1, Max tokens: 30000
ğŸ©º [VitalsParser] Found existing vitals: 1
ğŸ©º [VitalsParser] ğŸ¤– Calling OpenAI GPT-4.1-nano...
ğŸ©º [VitalsParser] ğŸ¤– Model: gpt-4.1-nano, Temperature: 0.1, Max tokens: 1500
ğŸ’Š [GPT] Calling GPT for medication extraction (attachment 19)
ğŸ’Š [GPT] ===== MEDICATION PROCESSING DEBUG INFO =====
ğŸ’Š [GPT] Extracted text length: 534 characters
ğŸ’Š [GPT] Existing medications count: 9
ğŸ’Š [GPT] Patient context: Age 69, Gender male
ğŸ’Š [GPT] Text preview (first 500 chars): Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  â€¢ BUN: 38 mg/dL
  â€¢ K+: 4.8 mmol/L
  â€¢ Na+: 135 mmol/L
  â€¢ Glucose: 210 mg/dL
  â€¢ Hgb A1c: 9.2% (poor diabetes control)
  â€¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  â€¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  â€¢ Findings: Atrial fibri...
ğŸ’Š [GPT] Text ending (last 500 chars): ...ial Workup Pending Further Testing)
Labwork 6/12/10
  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  â€¢ BUN: 38 mg/dL
  â€¢ K+: 4.8 mmol/L
  â€¢ Na+: 135 mmol/L
  â€¢ Glucose: 210 mg/dL
  â€¢ Hgb A1c: 9.2% (poor diabetes control)
  â€¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  â€¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  â€¢ Findings: Atrial fibrillation, no acute ischemic changes
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedSurgicalHistoryParser.processUnified (/home/runner/workspace/server/unified-surgical-history-parser.ts:121:9)
    at async AttachmentChartProcessor.processDocumentForSurgicalHistory (/home/runner/workspace/server/attachment-chart-processor.ts:629:22)
    at async Promise.allSettled (index 2)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
ğŸ”„ [UnifiedSurgicalHistory] Patient chart context: 0 medical problems, 0 medications
ğŸ”„ [UnifiedSurgicalHistory] ğŸ¤– Sending request to gpt-4.1-mini
ğŸ”„ [UnifiedSurgicalHistory] ğŸ¤– Content length: 568 characters
ğŸ”„ [UnifiedSurgicalHistory] ğŸ¤– Existing surgeries: 0
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Promise.all (index 3)
    at async UnifiedMedicalProblemsParser.processUnified (/home/runner/workspace/server/unified-medical-problems-parser.ts:111:9)
    at async AttachmentChartProcessor.processDocumentForMedicalProblems (/home/runner/workspace/server/attachment-chart-processor.ts:556:22)
    at async Promise.allSettled (index 1)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
ğŸ”„ [UnifiedMedicalProblems] Found 5 existing problems
ğŸ”„ [UnifiedMedicalProblems] Patient chart data: 0 problems, 0 medications, 0 vitals
ğŸ¤– [UnifiedGPT] Sending unified prompt to GPT-4.1
ğŸ¤– [UnifiedGPT] Prompt length: 26891 characters
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedSocialHistoryParser.processUnified (/home/runner/workspace/server/unified-social-history-parser.ts:125:9)
    at async AttachmentChartProcessor.processDocumentForSocialHistory (/home/runner/workspace/server/attachment-chart-processor.ts:970:22)
    at async Promise.allSettled (index 4)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
ğŸš¬ [UnifiedSocialHistory] Patient chart context: 0 medical problems, 0 medications
ğŸš¬ [UnifiedSocialHistory] ğŸ¤– Starting GPT-4.1 social history extraction
ğŸš¬ [UnifiedSocialHistory] Content length: 554 characters
ğŸš¬ [UnifiedSocialHistory] Existing entries: 0
ğŸš¬ [UnifiedSocialHistory] ============= GPT PROMPT DEBUG =============
ğŸš¬ [UnifiedSocialHistory] SYSTEM PROMPT (first 500 chars):
You are an expert clinical social worker and EMR data analyst with 15+ years of experience extracting and consolidating social history from medical documents.

SIMPLIFIED 7-CATEGORY SOCIAL HISTORY SYSTEM:
You MUST use EXACTLY these 7 categories (in this order):
1. "tobacco" - Any smoking, chewing, vaping, cigarettes, cigars, nicotine
2. "alcohol" - Any alcohol consumption, drinking, ETOH, beer, wine, liquor  
3. "drugs" - Recreational drugs, illicit substances, marijuana, cocaine, opioids, subst...
ğŸš¬ [UnifiedSocialHistory] USER CONTENT (first 1000 chars):
ATTACHMENT CONTENT:
Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  â€¢ BUN: 38 mg/dL
  â€¢ K+: 4.8 mmol/L
  â€¢ Na+: 135 mmol/L
  â€¢ Glucose: 210 mg/dL
  â€¢ Hgb A1c: 9.2% (poor diabetes control)
  â€¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  â€¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  â€¢ Findings: Atrial fibrillation, no acute ischemic changes...
ğŸš¬ [UnifiedSocialHistory] EXISTING SOCIAL HISTORY ENTRIES:
ğŸš¬ [UnifiedSocialHistory] ============= END PROMPT DEBUG =============
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedImagingParser.processAttachmentImagingData (/home/runner/workspace/server/unified-imaging-parser.ts:171:9)
    at async AttachmentChartProcessor.processDocumentForImaging (/home/runner/workspace/server/attachment-chart-processor.ts:1165:22)
    at async Promise.allSettled (index 7)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
ğŸ“„ [UnifiedImagingParser] Patient context loaded - Imaging count: 0
âŒ [UnifiedImagingParser] Attachment processing failed: error: column "clinical_summary" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async UnifiedImagingParser.getExistingImaging (/home/runner/workspace/server/unified-imaging-parser.ts:230:12)
    at async UnifiedImagingParser.processAttachmentImagingData (/home/runner/workspace/server/unified-imaging-parser.ts:177:31)
    at async AttachmentChartProcessor.processDocumentForImaging (/home/runner/workspace/server/attachment-chart-processor.ts:1165:22)
    at async Promise.allSettled (index 7)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9) {
  length: 117,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '101',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
ğŸ“¸ [ImagingExtraction] âœ… Successfully processed imaging in 889ms
ğŸ“¸ [ImagingExtraction] âœ… Total imaging results affected: 0
ğŸ“¸ [ImagingExtraction] âœ… Extraction confidence: 0
ğŸ“¸ [ImagingExtraction] âœ… Processing notes: Processing failed: column "clinical_summary" does not exist
ğŸ“¸ [ImagingExtraction] â„¹ï¸ No imaging changes made - may be no imaging content or all information already documented
ğŸ”¥ [IMAGING WORKFLOW] ============= IMAGING EXTRACTION COMPLETE =============
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedAllergyParser.processUnifiedAllergies (/home/runner/workspace/server/unified-allergy-parser.ts:125:9)
    at async AttachmentChartProcessor.processDocumentForAllergies (/home/runner/workspace/server/attachment-chart-processor.ts:1038:22)
    at async Promise.allSettled (index 5)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
ğŸš¨ [UnifiedAllergy] Patient chart context: 0 medical problems, 0 medications
ğŸ” [UnifiedAllergy] ===== SENDING PROMPT TO GPT =====
ğŸ” [UnifiedAllergy] Existing allergies in prompt: [
  'ID:8 Penicillin (resolved)',
  'ID:10 No Known Drug Allergies (resolved)'
]
ğŸ” [UnifiedAllergy] Combined content preview: ATTACHMENT CONTENT:
Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  â€¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  â€¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  â€¢ BUN: 38 mg/dL
  â€¢ K+: 4.8 mmol/L
  â€¢ Na+: 135 mmol/L
  â€¢ Glucose: 
ğŸ” [UnifiedAllergy] ===== END PROMPT CONTEXT =====
ğŸ”„ [UnifiedSurgicalHistory] ğŸ¤– GPT Response: []...
ğŸ”„ [UnifiedSurgicalHistory] âœ… Successfully parsed 0 surgical changes from GPT
ğŸ”„ [UnifiedSurgicalHistory] GPT processing complete, 0 surgical changes identified
ğŸ”„ [UnifiedSurgicalHistory] === PROCESSING COMPLETE ===
ğŸ”„ [UnifiedSurgicalHistory] Surgeries affected: 0
ğŸ¥ [SurgicalHistoryExtraction] âœ… Successfully processed surgical history in 1247ms
ğŸ¥ [SurgicalHistoryExtraction] âœ… Surgeries affected: 0
ğŸ¥ [SurgicalHistoryExtraction] âœ… Processing time: 1246ms
ğŸ¥ [SurgicalHistoryExtraction] âœ… Source summary: {
  encounter_surgeries: 0,
  attachment_surgeries: 0,
  conflicts_resolved: 0
}
ğŸ¥ [SurgicalHistoryExtraction] â„¹ï¸ No surgical history changes made - may be no surgical content or all procedures already documented
ğŸ”¥ [SURGICAL HISTORY WORKFLOW] ============= SURGICAL HISTORY EXTRACTION COMPLETE =============
ğŸš¬ [UnifiedSocialHistory] ============= GPT RESPONSE DEBUG =============
ğŸš¬ [UnifiedSocialHistory] GPT response length: 19 characters
ğŸš¬ [UnifiedSocialHistory] FULL GPT RESPONSE:
{
  "changes": []
}
ğŸš¬ [UnifiedSocialHistory] ============= END RESPONSE DEBUG =============
ğŸš¬ [UnifiedSocialHistory] Successfully parsed 0 social history changes
ğŸš¬ [UnifiedSocialHistory] PARSED CHANGES:
ğŸš¬ [UnifiedSocialHistory] GPT processing complete. Changes: 0
ğŸš¬ [UnifiedSocialHistory] ğŸ’¾ Applying 0 changes to database
ğŸš¬ [UnifiedSocialHistory] ğŸ”§ Database operation parameters:
ğŸš¬ [UnifiedSocialHistory] ğŸ”§   - patientId: 11
ğŸš¬ [UnifiedSocialHistory] ğŸ”§   - encounterId: null
ğŸš¬ [UnifiedSocialHistory] ğŸ”§   - attachmentId: 19
ğŸš¬ [UnifiedSocialHistory] ğŸ”§   - providerId: 1 (THIS SHOULD BE 1, NOT 2)
ğŸš¬ [UnifiedSocialHistory] ğŸ”§   - triggerType: attachment_processing
ğŸš¬ [UnifiedSocialHistory] ğŸ’¾ Database operations complete. 0 entries affected
ğŸš¬ [UnifiedSocialHistory] ============= UNIFIED SOCIAL HISTORY PROCESSING COMPLETE =============
ğŸš¬ [UnifiedSocialHistory] Total changes applied: 0
ğŸš¬ [UnifiedSocialHistory] Social history entries affected: 0
ğŸš­ [SocialHistoryExtraction] âœ… Successfully processed social history in 1276ms
ğŸš­ [SocialHistoryExtraction] âœ… Social history entries affected: 0
ğŸš­ [SocialHistoryExtraction] âœ… Encounter social history: 0
ğŸš­ [SocialHistoryExtraction] âœ… Attachment social history: 0
ğŸš­ [SocialHistoryExtraction] â„¹ï¸ No social history changes made - may be no social history content or all information already documented
ğŸ”¥ [SOCIAL HISTORY WORKFLOW] ============= SOCIAL HISTORY EXTRACTION COMPLETE =============
ğŸ’Š [GPT] Response received in 1121ms
ğŸ’Š [GPT] Response text length: 405 characters
ğŸ’Š [GPT] Raw response preview: {
  "extracted_date": "2010-06-12",
  "date_extraction_source": "header",
  "medications": [
    // No medications are explicitly mentioned, prescribed, discontinued, or changed in this document.
    // Only laboratory and imaging results are provided.
    // No new medications, dose changes, or discontinuations are referenced.
    // No allergies, intolerances, or adherence notes are documented.
  ]
}...
ğŸ’Š [GPT] Response ending: ...{
  "extracted_date": "2010-06-12",
  "date_extraction_source": "header",
  "medications": [
    // No medications are explicitly mentioned, prescribed, discontinued, or changed in this document.
    // Only laboratory and imaging results are provided.
    // No new medications, dose changes, or discontinuations are referenced.
    // No allergies, intolerances, or adherence notes are documented.
  ]