PM [express] GET /api/patients/7/draft-orders 304 in 182ms :: [{"id":188,"patientId":7,"enco‚Ä¶
ü§ñ [GPT] Raw response from GPT: ```json
{
  "changes": [
    {
      "problem_id": 3,
      "action": "ADD_VISIT",
      "visit_notes": "Suspected systemic lupus erythematosus with fatigue, facial rash, and joint swelling. Initiated hydroxychloroquine and ordered baseline labs. Referred to rheumatology.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Fatigue, Unspecified",
      "visit_notes": "Patient reports significant fatigue. Monitoring for improvement with lupus-directed therapy.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Arthralgia with Joint Swelling",
      "visit_notes": "Patient presents with joint swelling and pain. Symptomatic management with acetaminophen.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Facial Rash, Unspecified",
      "visit_notes": "Erythematous facial rash noted. Monitoring for progression and advised on sun protection.",
      "confidence": 0.95
    }
  ]
}
```
ü§ñ [GPT] Cleaned markdown formatting from response
ü§ñ [GPT] Cleaned content for parsing: {
  "changes": [
    {
      "problem_id": 3,
      "action": "ADD_VISIT",
      "visit_notes": "Suspected systemic lupus erythematosus with fatigue, facial rash, and joint swelling. Initiated hydroxychloroquine and ordered baseline labs. Referred to rheumatology.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Fatigue, Unspecified",
      "visit_notes": "Patient reports significant fatigue. Monitoring for improvement with lupus-directed therapy.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Arthralgia with Joint Swelling",
      "visit_notes": "Patient presents with joint swelling and pain. Symptomatic management with acetaminophen.",
      "confidence": 0.95
    },
    {
      "problem_id": null,
      "action": "NEW_PROBLEM",
      "problem_title": "Facial Rash, Unspecified",
      "visit_notes": "Erythematous facial rash noted. Monitoring for progression and advised on sun protection.",
      "confidence": 0.95
    }
  ]
}
ü§ñ [GPT] Parsed result: {
  changes: [
    {
      problem_id: 3,
      action: 'ADD_VISIT',
      visit_notes: 'Suspected systemic lupus erythematosus with fatigue, facial rash, and joint swelling. Initiated hydroxychloroquine and ordered baseline labs. Referred to rheumatology.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Fatigue, Unspecified',
      visit_notes: 'Patient reports significant fatigue. Monitoring for improvement with lupus-directed therapy.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Arthralgia with Joint Swelling',
      visit_notes: 'Patient presents with joint swelling and pain. Symptomatic management with acetaminophen.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Facial Rash, Unspecified',
      visit_notes: 'Erythematous facial rash noted. Monitoring for progression and advised on sun protection.',
      confidence: 0.95
    }
  ]
}
ü§ñ [GPT] Changes detected: 4
ü§ñ [GPT] Change 1: ADD_VISIT - existing (0.95)
ü§ñ [GPT] Change 2: NEW_PROBLEM - Fatigue, Unspecified (0.95)
ü§ñ [GPT] Change 3: NEW_PROBLEM - Arthralgia with Joint Swelling (0.95)
ü§ñ [GPT] Change 4: NEW_PROBLEM - Facial Rash, Unspecified (0.95)
üè• [DeltaService] GPT analysis completed. Generated 4 changes:
üè• [DeltaService] Change 1: ADD_VISIT - existing problem (confidence: 0.95)
üè• [DeltaService] Change 2: NEW_PROBLEM - Fatigue, Unspecified (confidence: 0.95)
üè• [DeltaService] Change 3: NEW_PROBLEM - Arthralgia with Joint Swelling (confidence: 0.95)
üè• [DeltaService] Change 4: NEW_PROBLEM - Facial Rash, Unspecified (confidence: 0.95)
üè• [DeltaService] Applying 4 changes to database...
[MedicalProblemsDelta] Updated problem 3 with visit entry
[MedicalProblemsDelta] Created new problem: Fatigue, Unspecified
[MedicalProblemsDelta] Created new problem: Arthralgia with Joint Swelling
[MedicalProblemsDelta] Created new problem: Facial Rash, Unspecified
üè• [DeltaService] Database changes applied successfully
‚úÖ [DeltaService] === DELTA PROCESSING COMPLETE ===
‚úÖ [DeltaService] Total time: 14772ms, Problems affected: 4
‚úÖ [MedicalProblemsAPI] Delta processing completed in 14772ms
‚úÖ [MedicalProblemsAPI] Result: {
  changes: [
    {
      problem_id: 3,
      action: 'ADD_VISIT',
      visit_notes: 'Suspected systemic lupus erythematosus with fatigue, facial rash, and joint swelling. Initiated hydroxychloroquine and ordered baseline labs. Referred to rheumatology.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Fatigue, Unspecified',
      visit_notes: 'Patient reports significant fatigue. Monitoring for improvement with lupus-directed therapy.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Arthralgia with Joint Swelling',
      visit_notes: 'Patient presents with joint swelling and pain. Symptomatic management with acetaminophen.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Facial Rash, Unspecified',
      visit_notes: 'Erythematous facial rash noted. Monitoring for progression and advised on sun protection.',
      confidence: 0.95
    }
  ],
  processing_time_ms: 14772,
  total_problems_affected: 4
}
‚úÖ [MedicalProblemsAPI] Sending response: {
  success: true,
  changes: [
    {
      problem_id: 3,
      action: 'ADD_VISIT',
      visit_notes: 'Suspected systemic lupus erythematosus with fatigue, facial rash, and joint swelling. Initiated hydroxychloroquine and ordered baseline labs. Referred to rheumatology.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Fatigue, Unspecified',
      visit_notes: 'Patient reports significant fatigue. Monitoring for improvement with lupus-directed therapy.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Arthralgia with Joint Swelling',
      visit_notes: 'Patient presents with joint swelling and pain. Symptomatic management with acetaminophen.',
      confidence: 0.95
    },
    {
      problem_id: null,
      action: 'NEW_PROBLEM',
      problem_title: 'Facial Rash, Unspecified',
      visit_notes: 'Erythematous facial rash noted. Monitoring for progression and advised on sun protection.',
      confidence: 0.95
    }
  ],
  processingTimeMs: 14772,
  problemsAffected: 4
}