yHistoryExtraction] ‚ÑπÔ∏è No family history changes made - may be no family history content or all information already documented
üî• [FAMILY HISTORY WORKFLOW] ============= FAMILY HISTORY EXTRACTION COMPLETE =============
üö¨ [UnifiedSocialHistory] Error fetching existing social history: error: column "source_notes" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async UnifiedSocialHistoryParser.getExistingSocialHistory (/home/runner/workspace/server/unified-social-history-parser.ts:184:24)
    at async UnifiedSocialHistoryParser.processUnified (/home/runner/workspace/server/unified-social-history-parser.ts:118:9)
    at async AttachmentChartProcessor.processDocumentForSocialHistory (/home/runner/workspace/server/attachment-chart-processor.ts:970:22)
    at async Promise.allSettled (index 4)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9) {
  length: 113,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '137',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
üö¨ [UnifiedSocialHistory] Found 0 existing social history entries for patient 11
[Chart Service] Fetching chart data for patient 11
üìÑ [UnifiedImagingParser] Patient ID: 11
[Chart Service] Fetching chart data for patient 11
üíä [AttachmentMedications] Found 9 existing medications for consolidation
ü©∫ [VitalsExtraction] üîç Calling parseVitalsText with: {
  textLength: 534,
  textPreview: 'Laboratory & Imaging Results (Initial Workup Pending Further Testing)\n' +
    'Labwork 6/12/10\n' +
    '  ‚Ä¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)\n' +
    '  ‚Ä¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight w',
  patientContext: { age: 69, gender: 'male' },
  patientId: 11
}
üî• [VITALS PARSING] ============= STARTING GPT-4.1-NANO VITALS PARSING =============
ü©∫ [VitalsParser] Input text length: 534 characters
ü©∫ [VitalsParser] Patient context: { age: 69, gender: 'male' }
ü©∫ [VitalsParser] Parsing vitals text preview: Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  ‚Ä¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  ‚Ä¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight w...
ü©∫ [VitalsParser] Starting AI parsing process...
üö® [UnifiedAllergy] Found 2 existing allergy entries for patient 11
[Chart Service] Fetching chart data for patient 11
‚öóÔ∏è [LabParser] Found 0 existing lab results for consolidation analysis
‚öóÔ∏è [LabParser] ü§ñ Calling OpenAI GPT-4.1...
‚öóÔ∏è [LabParser] ü§ñ Model: gpt-4.1, Temperature: 0.1, Max tokens: 30000
ü©∫ [VitalsParser] Found existing vitals: 1
ü©∫ [VitalsParser] ü§ñ Calling OpenAI GPT-4.1-nano...
ü©∫ [VitalsParser] ü§ñ Model: gpt-4.1-nano, Temperature: 0.1, Max tokens: 1500
üíä [GPT] Calling GPT for medication extraction (attachment 19)
üíä [GPT] ===== MEDICATION PROCESSING DEBUG INFO =====
üíä [GPT] Extracted text length: 534 characters
üíä [GPT] Existing medications count: 9
üíä [GPT] Patient context: Age 69, Gender male
üíä [GPT] Text preview (first 500 chars): Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  ‚Ä¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  ‚Ä¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  ‚Ä¢ BUN: 38 mg/dL
  ‚Ä¢ K+: 4.8 mmol/L
  ‚Ä¢ Na+: 135 mmol/L
  ‚Ä¢ Glucose: 210 mg/dL
  ‚Ä¢ Hgb A1c: 9.2% (poor diabetes control)
  ‚Ä¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  ‚Ä¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  ‚Ä¢ Findings: Atrial fibri...
üíä [GPT] Text ending (last 500 chars): ...ial Workup Pending Further Testing)
Labwork 6/12/10
  ‚Ä¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  ‚Ä¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  ‚Ä¢ BUN: 38 mg/dL
  ‚Ä¢ K+: 4.8 mmol/L
  ‚Ä¢ Na+: 135 mmol/L
  ‚Ä¢ Glucose: 210 mg/dL
  ‚Ä¢ Hgb A1c: 9.2% (poor diabetes control)
  ‚Ä¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  ‚Ä¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  ‚Ä¢ Findings: Atrial fibrillation, no acute ischemic changes
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedSurgicalHistoryParser.processUnified (/home/runner/workspace/server/unified-surgical-history-parser.ts:121:9)
    at async AttachmentChartProcessor.processDocumentForSurgicalHistory (/home/runner/workspace/server/attachment-chart-processor.ts:629:22)
    at async Promise.allSettled (index 2)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
üîÑ [UnifiedSurgicalHistory] Patient chart context: 0 medical problems, 0 medications
üîÑ [UnifiedSurgicalHistory] ü§ñ Sending request to gpt-4.1-mini
üîÑ [UnifiedSurgicalHistory] ü§ñ Content length: 568 characters
üîÑ [UnifiedSurgicalHistory] ü§ñ Existing surgeries: 0
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Promise.all (index 3)
    at async UnifiedMedicalProblemsParser.processUnified (/home/runner/workspace/server/unified-medical-problems-parser.ts:111:9)
    at async AttachmentChartProcessor.processDocumentForMedicalProblems (/home/runner/workspace/server/attachment-chart-processor.ts:556:22)
    at async Promise.allSettled (index 1)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
üîÑ [UnifiedMedicalProblems] Found 5 existing problems
üîÑ [UnifiedMedicalProblems] Patient chart data: 0 problems, 0 medications, 0 vitals
ü§ñ [UnifiedGPT] Sending unified prompt to GPT-4.1
ü§ñ [UnifiedGPT] Prompt length: 26891 characters
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedSocialHistoryParser.processUnified (/home/runner/workspace/server/unified-social-history-parser.ts:125:9)
    at async AttachmentChartProcessor.processDocumentForSocialHistory (/home/runner/workspace/server/attachment-chart-processor.ts:970:22)
    at async Promise.allSettled (index 4)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
üö¨ [UnifiedSocialHistory] Patient chart context: 0 medical problems, 0 medications
üö¨ [UnifiedSocialHistory] ü§ñ Starting GPT-4.1 social history extraction
üö¨ [UnifiedSocialHistory] Content length: 554 characters
üö¨ [UnifiedSocialHistory] Existing entries: 0
üö¨ [UnifiedSocialHistory] ============= GPT PROMPT DEBUG =============
üö¨ [UnifiedSocialHistory] SYSTEM PROMPT (first 500 chars):
You are an expert clinical social worker and EMR data analyst with 15+ years of experience extracting and consolidating social history from medical documents.

SIMPLIFIED 7-CATEGORY SOCIAL HISTORY SYSTEM:
You MUST use EXACTLY these 7 categories (in this order):
1. "tobacco" - Any smoking, chewing, vaping, cigarettes, cigars, nicotine
2. "alcohol" - Any alcohol consumption, drinking, ETOH, beer, wine, liquor  
3. "drugs" - Recreational drugs, illicit substances, marijuana, cocaine, opioids, subst...
üö¨ [UnifiedSocialHistory] USER CONTENT (first 1000 chars):
ATTACHMENT CONTENT:
Laboratory & Imaging Results (Initial Workup Pending Further Testing)
Labwork 6/12/10
  ‚Ä¢ BNP: 980 pg/mL (elevated, consistent with CHF exacerbation)
  ‚Ä¢ Creatinine: 2.1 mg/dL (baseline ~1.8, slight worsening)
  ‚Ä¢ BUN: 38 mg/dL
  ‚Ä¢ K+: 4.8 mmol/L
  ‚Ä¢ Na+: 135 mmol/L
  ‚Ä¢ Glucose: 210 mg/dL
  ‚Ä¢ Hgb A1c: 9.2% (poor diabetes control)
  ‚Ä¢ INR: 2.1 (therapeutic)
Chest X-ray 6/12/10
  ‚Ä¢ Findings: Cardiomegaly, bilateral pulmonary congestion, mild pleural effusions
ECG 6/12/10
  ‚Ä¢ Findings: Atrial fibrillation, no acute ischemic changes...
üö¨ [UnifiedSocialHistory] EXISTING SOCIAL HISTORY ENTRIES:
üö¨ [UnifiedSocialHistory] ============= END PROMPT DEBUG =============
[Chart Service] Error fetching patient chart data: ReferenceError: sql is not defined
    at Function.getPatientChartData (/home/runner/workspace/server/patient-chart-service.ts:91:44)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async UnifiedImagingParser.processAttachmentImagingData (/home/runner/workspace/server/unified-imaging-parser.ts:171:9)
    at async AttachmentChartProcessor.processDocumentForImaging (/home/runner/workspace/server/attachment-chart-processor.ts:1165:22)
    at async Promise.allSettled (index 7)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9)
üìÑ [UnifiedImagingParser] Patient context loaded - Imaging count: 0
‚ùå [UnifiedImagingParser] Attachment processing failed: error: column "clinical_summary" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async UnifiedImagingParser.getExistingImaging (/home/runner/workspace/server/unified-imaging-parser.ts:230:12)
    at async UnifiedImagingParser.processAttachmentImagingData (/home/runner/workspace/server/unified-imaging-parser.ts:177:31)
    at async AttachmentChartProcessor.processDocumentForImaging (/home/runner/workspace/server/attachment-chart-processor.ts:1165:22)
    at async Promise.allSettled (index 7)
    at async AttachmentChartProcessor.processCompletedAttachment (/home/runner/workspace/server/attachment-chart-processor.ts:100:183)
    at async DocumentAnalysisService.triggerChartProcessing (/home/runner/workspace/server/document-analysis-service.ts:643:7)
    at async DocumentAnalysisService.processDocument (/home/runner/workspace/server/document-analysis-service.ts:185:9) {
  length: 117,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '101',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'