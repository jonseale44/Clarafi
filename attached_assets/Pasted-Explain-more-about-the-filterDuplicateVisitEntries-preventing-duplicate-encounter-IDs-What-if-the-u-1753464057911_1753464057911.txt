Explain more about the filterDuplicateVisitEntries preventing duplicate encounter IDs. What if the user uploads two different attachments while the user is IN an encounter? Would this filter out the second attachment, since it’s in the same encounter as the first? Keep in mind that we already have logic preventing duplicate attachments from being uploaded so it’s really impossible to have duplicate attachmentIDs, right? 

I’m ok with option 1 as long as it employs consolidation within a visit history. Take a look at how we consolidate medical problems. We HIGHLY (maybe entirely) leverage GPT’s intelligence to accomplish this. There is little, if any, frontend logic here. The reason is because I want to intelligently consolidate medical problems and “carry forward” their visit history (e.g. type 2 diabetes -> type 2 diabetes with neuropathy and the entire visit history comes with it. If we do option 1 exactly as you said, I’m concerned we will artificially filter out duplicate visit-history dates, not allowing GPT to decide if the second date has information relevant to the visit history and therefore should be consolidated. I want GPT to be forced to continue “thinking” when it encounters repeated dates. For example. Suppose the first attachment had date 12/12/2018 and mentioned pt was on metformin 500mg BID and A1c is 6.5. GPT might first create a visit history that says: “12/12/2018: A1c 6.5, continued metformin 500mg BID.”. Then a separate attachment (or perhaps a mention by the patient during the SOAP note) said something about the patient also being on glyburide 5mg BID which was started on 12/12/2018. If the system decides that this is a “duplicate visit history date” (which it should), GPT should be able to take the prior visit history and IMPROVE IT in the following way: “12/12/2018: A1c 6.5 while on metformin 500mg BID, started pt on glyburide 5mg BID”. That is a SINGLE visit history for that date. So it’s not just deduplicating, it’s consolidating, just like we do with the medical problem itself. Looking at your options again, I think option 2 might be better but what do you think? 
